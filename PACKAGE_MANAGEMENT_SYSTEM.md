# نظام إدارة الحزم - Package Management System

## نظرة عامة

تم إضافة نظام إدارة الحزم إلى لوحة تحكم الإدارة، مما يتيح للمديرين التحكم في حزم الألعاب المتاحة للمستخدمين، بما في ذلك التسعير والميزات.

## الميزات الرئيسية

### 1. إدارة الحزم
- **إضافة حزمة جديدة**: إنشاء حزم ألعاب جديدة مع تحديد السعر وعدد الألعاب
- **تعديل الحزم**: تحديث معلومات الحزم الموجودة
- **حذف الحزم**: إزالة الحزم غير المرغوب فيها
- **تفعيل/إلغاء تفعيل**: التحكم في ظهور الحزم للمستخدمين

### 2. إدارة الميزات
- **إضافة ميزات**: تحديد ميزات كل حزمة (عربي/إنجليزي)
- **أيقونات الميزات**: دعم أيقونات مختلفة لكل ميزة
- **ترتيب الميزات**: تحديد ترتيب عرض الميزات

### 3. التسعير المرن
- **أسعار مختلفة**: إمكانية تحديد أسعار مختلفة لكل حزمة
- **خصومات تلقائية**: عرض التوفير عند شراء حزم متعددة
- **عدد الألعاب**: تحديد عدد الألعاب في كل حزمة

## بنية قاعدة البيانات

### جدول `game_packages`
```sql
CREATE TABLE public.game_packages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name_ar TEXT NOT NULL,                    -- اسم الحزمة بالعربية
  name_en TEXT NOT NULL,                    -- اسم الحزمة بالإنجليزية
  description_ar TEXT,                      -- وصف الحزمة بالعربية
  description_en TEXT,                      -- وصف الحزمة بالإنجليزية
  price NUMERIC(10,2) NOT NULL,             -- سعر الحزمة
  games_count INTEGER NOT NULL DEFAULT 1,   -- عدد الألعاب في الحزمة
  is_active BOOLEAN NOT NULL DEFAULT true,  -- حالة التفعيل
  is_popular BOOLEAN NOT NULL DEFAULT false, -- الأكثر شعبية
  sort_order INTEGER DEFAULT 0,             -- ترتيب العرض
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()
);
```

### جدول `game_package_features`
```sql
CREATE TABLE public.game_package_features (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  package_id UUID NOT NULL REFERENCES public.game_packages(id) ON DELETE CASCADE,
  feature_ar TEXT NOT NULL,                 -- الميزة بالعربية
  feature_en TEXT NOT NULL,                 -- الميزة بالإنجليزية
  icon TEXT,                                -- أيقونة الميزة
  sort_order INTEGER DEFAULT 0,             -- ترتيب الميزة
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()
);
```

### تحديث جدول `game_purchases`
```sql
ALTER TABLE public.game_purchases 
ADD COLUMN package_id UUID REFERENCES public.game_packages(id);
```

## الحزم الافتراضية

تم إنشاء 4 حزم افتراضية:

1. **حزمة لعبة واحدة** - $9.99
   - لعبة واحدة
   - 6 فئات
   - الأكثر شعبية

2. **حزمة 3 ألعاب** - $26.99
   - 3 ألعاب
   - 18 فئة
   - خصم 10%

3. **حزمة 5 ألعاب** - $42.99
   - 5 ألعاب
   - 30 فئة
   - خصم 15%

4. **حزمة 10 ألعاب** - $74.99
   - 10 ألعاب
   - 60 فئة
   - خصم 25%

## كيفية الاستخدام

### في لوحة الإدارة

1. **الوصول إلى إدارة الحزم**:
   - انتقل إلى لوحة الإدارة
   - اختر "إدارة الحزم" من القائمة الجانبية

2. **إضافة حزمة جديدة**:
   - انقر على "إضافة حزمة جديدة"
   - املأ المعلومات المطلوبة:
     - اسم الحزمة (عربي/إنجليزي)
     - وصف الحزمة
     - السعر
     - عدد الألعاب
     - حالة التفعيل
     - الأكثر شعبية
   - أضف الميزات المطلوبة
   - احفظ الحزمة

3. **تعديل حزمة موجودة**:
   - انقر على أيقونة التعديل بجانب الحزمة
   - عدل المعلومات المطلوبة
   - احفظ التغييرات

4. **حذف حزمة**:
   - انقر على أيقونة الحذف بجانب الحزمة
   - أكد الحذف

### للمستخدمين

1. **عرض الحزم**:
   - انتقل إلى صفحة "شراء لعبة"
   - ستظهر جميع الحزم النشطة

2. **اختيار الحزمة**:
   - انقر على الحزمة المطلوبة
   - راجع التفاصيل والميزات

3. **شراء الحزمة**:
   - انقر على "شراء الحزمة"
   - سيتم إنشاء عدد الألعاب المحدد
   - انتقل لاختيار الفئات

## الأمان والصلاحيات

- **الوصول**: فقط المديرون يمكنهم الوصول لإدارة الحزم
- **RLS Policies**: تم تطبيق سياسات أمان مناسبة
- **التحقق**: التحقق من صحة البيانات قبل الحفظ

## التطوير المستقبلي

### الميزات المقترحة

1. **خصومات موسمية**:
   - خصومات في أوقات محددة
   - أكواد خصم للحزم

2. **حزم مخصصة**:
   - حزم حسب الفئات
   - حزم للمجموعات

3. **إحصائيات الحزم**:
   - أكثر الحزم مبيعاً
   - تحليل المبيعات

4. **تجديد الحزم**:
   - إعادة شراء الحزم
   - ترقية الحزم

### التحسينات التقنية

1. **Cache الحزم**:
   - تخزين مؤقت للحزم النشطة
   - تحسين الأداء

2. **Webhooks**:
   - إشعارات عند تغيير الحزم
   - تكامل مع أنظمة خارجية

3. **API للحزم**:
   - واجهة برمجة للحزم
   - تكامل مع تطبيقات أخرى

## استكشاف الأخطاء

### مشاكل شائعة

1. **الحزمة لا تظهر للمستخدمين**:
   - تحقق من `is_active = true`
   - تحقق من `sort_order`

2. **خطأ في السعر**:
   - تأكد من أن السعر رقم موجب
   - تحقق من تنسيق السعر

3. **مشاكل في الميزات**:
   - تأكد من وجود `feature_ar` و `feature_en`
   - تحقق من `sort_order` للميزات

### سجلات الأخطاء

- راجع سجلات Supabase للأخطاء
- تحقق من RLS policies
- راجع console المتصفح للأخطاء

## الدعم

للمساعدة أو الإبلاغ عن مشاكل:
- راجع هذا التوثيق
- تحقق من سجلات الأخطاء
- اتصل بفريق التطوير
